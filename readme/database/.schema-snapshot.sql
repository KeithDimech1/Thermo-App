-- Database Schema Snapshot
-- Generated: 2025-11-21 $(date '+%H:%M:%S')
-- Database: Supabase PostgreSQL (ggkrikijxollyolifdqs)
-- Connection: aws-1-ap-southeast-1.pooler.supabase.com:5432
-- Generated by: /bigtidy living documentation system
-- Migration Note: Migrated from Neon to Supabase (ERROR-021)

CREATE TABLE public.batches (
    id integer NOT NULL,
    batch_name character varying(200) NOT NULL,
    analysis_date date,
    laboratory character varying(200),
    analytical_session character varying(200),
    irradiation_id character varying(100),
    irradiation_reactor character varying(100),
    thermal_neutron_dose numeric(18,2),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.data_files (
    id integer NOT NULL,
    dataset_id integer,
    file_type character varying(50) NOT NULL,
    file_path text NOT NULL,
    file_name text NOT NULL,
    file_size_bytes bigint,
    mime_type character varying(100),
    description text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.datapoint_people_roles (
    id integer NOT NULL,
    datapoint_id integer NOT NULL,
    datapoint_type character varying(20) NOT NULL,
    person_id integer NOT NULL,
    role character varying(50) NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT check_datapoint_type CHECK (((datapoint_type)::text = ANY ((ARRAY['ft'::character varying, 'he'::character varying, 'upb'::character varying, 'trace'::character varying])::text[])))
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.dataset_people_roles (
    id integer NOT NULL,
    dataset_id integer,
    person_id integer,
    role character varying(100) NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.datasets (
    id integer NOT NULL,
    dataset_name character varying(200) NOT NULL,
    description text,
    publication_reference text,
    publication_doi character varying(100),
    study_area character varying(200),
    privacy_status character varying(20) DEFAULT 'public'::character varying,
    embargo_date date,
    data_package_doi character varying(100),
    keywords text,
    data_owner character varying(200),
    license character varying(100) DEFAULT 'CC-BY-4.0'::character varying,
    submission_date date DEFAULT CURRENT_DATE,
    last_modified_date date DEFAULT CURRENT_DATE,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT check_privacy_status CHECK (((privacy_status)::text = ANY ((ARRAY['public'::character varying, 'embargo'::character varying, 'private'::character varying])::text[])))
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public."earthbank_ftDatapoints" (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    "datapointName" character varying(255) NOT NULL,
    "sampleID" character varying(255) NOT NULL,
    laboratory character varying(255),
    analyst character varying(255),
    "analysisDate" timestamp without time zone,
    "labNumber" character varying(100),
    "ftMethod" character varying(100),
    "mineralType" character varying(100),
    "nGrains" integer,
    "totalNs" integer,
    "rhoS" numeric(15,6),
    "uPpm" numeric(10,2),
    "uPpmStdDev" numeric(10,2),
    "uConcentration" numeric(10,2),
    "dPar" numeric(10,3),
    "dParUncertainty" numeric(10,3),
    "pChi2" numeric(10,2),
    dispersion numeric(10,4),
    "pooledAgeMa" numeric(10,2),
    "pooledAgeUncertainty" numeric(10,2),
    "centralAgeMa" numeric(10,2),
    "centralAgeUncertainty" numeric(10,2),
    mtl numeric(10,3),
    "mtlUncertainty" numeric(10,3),
    "stdDevMu" numeric(10,3),
    "nTracks" integer,
    "sigmaP" numeric(10,4),
    "sigmaPError" numeric(10,4),
    zeta numeric(12,4),
    "zetaUncertainty" numeric(12,4),
    "createdAt" timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE public."earthbank_ftTrackLengthData" (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    "datapointName" character varying(255) NOT NULL,
    "sampleID" character varying(255),
    "grainName" character varying(100),
    "trackID" character varying(100),
    "trackType" character varying(100),
    "lengthUm" numeric(10,3),
    "cAxisAngleDeg" numeric(10,2),
    "dPar" numeric(10,3),
    "createdAt" timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE public."earthbank_heDatapoints" (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    "datapointName" character varying(255) NOT NULL,
    "sampleID" character varying(255) NOT NULL,
    "ftMethod" character varying(100),
    laboratory character varying(255),
    analyst character varying(255),
    "analysisDate" timestamp without time zone,
    "nGrains" integer,
    "meanCorrectedAgeMa" numeric(10,2),
    "meanCorrectedAgeUncertainty" numeric(10,2),
    "meanUncorrectedAgeMa" numeric(10,2),
    notes text,
    "createdAt" timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE public."earthbank_heWholeGrainData" (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    "datapointName" character varying(255) NOT NULL,
    "sampleID" character varying(255),
    "grainName" character varying(100) NOT NULL,
    "correctedHeAge" numeric(10,2),
    "correctedHeAgeUncertainty" numeric(10,2),
    "uncorrectedHeAge" numeric(10,2),
    "uncorrectedHeAgeUncertainty" numeric(10,2),
    ft numeric(10,4),
    "ftU238" numeric(10,4),
    "ftU235" numeric(10,4),
    "ftTh232" numeric(10,4),
    "ftSm147" numeric(10,4),
    "he4Concentration" numeric(15,6),
    "he4ConcentrationUncertainty" numeric(15,6),
    "heNmolG" numeric(15,6),
    "heNmolGUncertainty" numeric(15,6),
    "uConcentration" numeric(10,2),
    "uConcentrationUncertainty" numeric(10,2),
    "uNg" numeric(15,6),
    "uNgUncertainty" numeric(15,6),
    "thConcentration" numeric(10,2),
    "thConcentrationUncertainty" numeric(10,2),
    "thNg" numeric(15,6),
    "thNgUncertainty" numeric(15,6),
    "smConcentration" numeric(10,2),
    "smConcentrationUncertainty" numeric(10,2),
    "smNg" numeric(15,6),
    "smNgUncertainty" numeric(15,6),
    "eU" numeric(10,2),
    "eUUncertainty" numeric(10,2),
    "rsUm" numeric(12,3),
    "massMg" numeric(12,6),
    geometry character varying(100),
    "lengthUm" numeric(12,3),
    "widthUm" numeric(12,3),
    "numPits" integer,
    "createdAt" timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE public.earthbank_samples (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    "sampleID" character varying(255) NOT NULL,
    "IGSN" character varying(20),
    latitude numeric(10,6),
    longitude numeric(10,6),
    "elevationM" numeric(10,2),
    "geodeticDatum" character varying(50),
    "verticalDatum" character varying(50),
    mineral character varying(100),
    "mineralType" character varying(100),
    lithology character varying(100),
    "sampleKind" character varying(100),
    "sampleAgeMa" numeric(10,2),
    collector character varying(255),
    "collectionDate" date,
    "collectionYear" integer,
    "datasetID" character varying(100),
    "nAFTGrains" integer,
    "nAHeGrains" integer,
    quadrangle character varying(255),
    "faultBlock" character varying(100),
    "igneousAgeMa" numeric(10,2),
    "igneousAgeErrorMa" numeric(10,2),
    project character varying(255),
    country character varying(100),
    "stateProvince" character varying(100),
    "locationDescription" text,
    "createdAt" timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE public.extraction_sessions (
    id uuid DEFAULT extensions.uuid_generate_v4() NOT NULL,
    session_id text NOT NULL,
    pdf_filename text NOT NULL,
    pdf_path text NOT NULL,
    pdf_size_bytes bigint NOT NULL,
    state text DEFAULT 'uploaded'::text NOT NULL,
    current_step integer DEFAULT 1,
    paper_metadata jsonb,
    tables_found integer,
    data_types text[],
    csvs_extracted integer,
    extraction_quality_score integer,
    failed_tables text[],
    dataset_id integer,
    fair_score integer,
    records_imported integer,
    user_id text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    completed_at timestamp with time zone,
    error_message text,
    error_stage text
);
CREATE TABLE public.fair_score_breakdown (
    id integer NOT NULL,
    dataset_id integer,
    findable_score integer DEFAULT 0,
    has_persistent_id boolean DEFAULT false,
    has_descriptive_metadata boolean DEFAULT false,
    has_keywords boolean DEFAULT false,
    accessible_score integer DEFAULT 0,
    has_open_access boolean DEFAULT false,
    has_standard_protocol boolean DEFAULT false,
    interoperable_score integer DEFAULT 0,
    uses_standard_format boolean DEFAULT false,
    uses_controlled_vocab boolean DEFAULT false,
    has_field_definitions boolean DEFAULT false,
    reusable_score integer DEFAULT 0,
    has_license boolean DEFAULT false,
    has_provenance boolean DEFAULT false,
    has_qc_metrics boolean DEFAULT false,
    total_score integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.ft_binned_length_data (
    id integer NOT NULL,
    ft_datapoint_id integer NOT NULL,
    mount_id character varying(50),
    etch_duration_seconds integer,
    bin_0_1_um integer,
    bin_1_2_um integer,
    bin_2_3_um integer,
    bin_3_4_um integer,
    bin_4_5_um integer,
    bin_5_6_um integer,
    bin_6_7_um integer,
    bin_7_8_um integer,
    bin_8_9_um integer,
    bin_9_10_um integer,
    bin_10_11_um integer,
    bin_11_12_um integer,
    bin_12_13_um integer,
    bin_13_14_um integer,
    bin_14_15_um integer,
    bin_15_16_um integer,
    bin_16_17_um integer,
    bin_17_18_um integer,
    bin_18_19_um integer,
    bin_19_20_um integer,
    dpar_um numeric(6,3),
    dpar_error_um numeric(6,3),
    n_dpar_measurements integer,
    dper_um numeric(6,3),
    dper_error_um numeric(6,3),
    n_dper_measurements integer,
    dpar_dper_error_type character varying(20),
    comments text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.ft_count_data (
    id integer NOT NULL,
    ft_datapoint_id integer NOT NULL,
    grain_id character varying(100) NOT NULL,
    counting_area_cm2 numeric(10,6),
    ns integer,
    rho_s_cm2 numeric(12,2),
    ni integer,
    rho_i_cm2 numeric(12,2),
    nd integer,
    rho_d_cm2 numeric(12,2),
    dpar_um numeric(6,3),
    dpar_error_um numeric(6,3),
    n_dpar_measurements integer,
    dper_um numeric(6,3),
    dper_error_um numeric(6,3),
    n_dper_measurements integer,
    dpar_dper_error_type character varying(20),
    comments text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.ft_datapoints (
    id integer NOT NULL,
    sample_id character varying(50) NOT NULL,
    datapoint_key character varying(100) NOT NULL,
    batch_id integer,
    laboratory character varying(200),
    analyst_orcid character varying(50),
    analysis_date timestamp without time zone,
    publication_doi character varying(100),
    mineral_type character varying(50),
    ft_method character varying(50),
    ft_software character varying(100),
    ft_algorithm character varying(50),
    u_determination_method character varying(100),
    n_grains integer,
    total_area_cm2 numeric(10,6),
    mean_rho_s numeric(12,2),
    total_ns integer,
    mean_rho_i numeric(12,2),
    total_ni integer,
    mean_rho_d numeric(12,2),
    total_nd integer,
    dosimeter character varying(50),
    mean_u_ppm numeric(10,3),
    sd_u_ppm numeric(10,3),
    mean_dpar_um numeric(6,3),
    se_dpar_um numeric(6,3),
    n_dpar_measurements integer,
    mean_dper_um numeric(6,3),
    se_dper_um numeric(6,3),
    n_dper_measurements integer,
    mean_rmr0 numeric(6,4),
    sd_rmr0 numeric(6,4),
    mean_kappa numeric(6,4),
    sd_kappa numeric(6,4),
    rmr0_equation character varying(100),
    chi_square numeric(12,6),
    p_chi2_pct numeric(6,3),
    dispersion_pct numeric(6,4),
    age_equation character varying(100),
    mean_age_ma numeric(10,2),
    mean_age_error_ma numeric(10,2),
    central_age_ma numeric(10,2),
    central_age_error_ma numeric(10,2),
    pooled_age_ma numeric(10,2),
    pooled_age_error_ma numeric(10,2),
    population_age_ma numeric(10,2),
    population_age_error_ma numeric(10,2),
    age_error_type character varying(20),
    age_comment text,
    mean_track_length_um numeric(6,3),
    se_mean_track_length_um numeric(6,3),
    n_track_measurements integer,
    sd_track_length_um numeric(6,3),
    cf252_irradiation boolean,
    etchant_chemical character varying(100),
    etch_duration_seconds integer,
    etch_temperature_c numeric(5,2),
    zeta_yr_cm2 numeric(12,6),
    zeta_error_yr_cm2 numeric(12,6),
    zeta_error_type character varying(20),
    r_um numeric(8,3),
    lambda_d character varying(30),
    lambda_f character varying(30),
    q_factor numeric(6,4),
    irradiation_reactor character varying(100),
    thermal_neutron_dose numeric(18,2),
    irradiation_batch_id character varying(100),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.ft_single_grain_ages (
    id integer NOT NULL,
    ft_datapoint_id integer NOT NULL,
    grain_id character varying(100) NOT NULL,
    mount_id character varying(50),
    etch_duration_seconds integer,
    u_ppm numeric(10,3),
    u_ppm_error numeric(10,3),
    u_ca_ratio numeric(10,6),
    u_ca_ratio_error numeric(10,6),
    u_ca_error_type character varying(20),
    rmr0 numeric(6,4),
    kappa numeric(6,4),
    grain_age_ma numeric(10,2),
    grain_age_error_ma numeric(10,2),
    grain_age_error_type character varying(20),
    comments text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.ft_track_length_data (
    id integer NOT NULL,
    ft_datapoint_id integer NOT NULL,
    grain_id character varying(100) NOT NULL,
    track_id character varying(100) NOT NULL,
    track_type character varying(20),
    mount_id character varying(50),
    etch_duration_seconds integer,
    apparent_length_um numeric(6,3),
    corrected_z_depth_um numeric(8,2),
    true_length_um numeric(6,3),
    azimuth_deg numeric(6,2),
    dip_deg numeric(6,2),
    angle_to_c_axis_deg numeric(6,2),
    c_axis_corrected_length_um numeric(6,3),
    dpar_um numeric(6,3),
    dpar_error_um numeric(6,3),
    n_dpar_measurements integer,
    dper_um numeric(6,3),
    dper_error_um numeric(6,3),
    n_dper_measurements integer,
    dpar_dper_error_type character varying(20),
    rmr0 numeric(6,4),
    kappa numeric(6,4),
    comments text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT check_track_type CHECK (((track_type)::text = ANY ((ARRAY['TINT'::character varying, 'TINCLE'::character varying, 'semi-track'::character varying, NULL::character varying])::text[])))
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.grains (
    id integer NOT NULL,
    grain_id character varying(100) NOT NULL,
    mount_id character varying(50),
    grain_identifier character varying(100),
    grain_morphology character varying(50),
    grain_quality character varying(50),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.he_datapoints (
    id integer NOT NULL,
    sample_id character varying(50) NOT NULL,
    datapoint_key character varying(100) NOT NULL,
    batch_id integer,
    laboratory character varying(200),
    analyst_orcid character varying(50),
    analysis_date timestamp without time zone,
    publication_doi character varying(100),
    mineral_type character varying(50),
    mount_id character varying(50),
    n_aliquots integer,
    mean_uncorr_age_ma numeric(10,2),
    mean_uncorr_age_error_ma numeric(10,2),
    mean_uncorr_age_error_type character varying(20),
    weighted_mean_uncorr_age_ma numeric(10,2),
    weighted_mean_uncorr_age_error_ma numeric(10,2),
    weighted_mean_uncorr_age_error_type character varying(20),
    mswd_uncorr numeric(8,4),
    conf95_uncorr_ma numeric(10,2),
    chi2_uncorr_pct numeric(6,3),
    iqr_uncorr_ma numeric(10,2),
    mean_corr_age_ma numeric(10,2),
    mean_corr_age_error_ma numeric(10,2),
    mean_corr_age_error_type character varying(20),
    weighted_mean_corr_age_ma numeric(10,2),
    weighted_mean_corr_age_error_ma numeric(10,2),
    weighted_mean_corr_age_error_type character varying(20),
    mswd_corr numeric(8,4),
    conf95_corr_ma numeric(10,2),
    chi2_corr_pct numeric(6,3),
    iqr_corr_ma numeric(10,2),
    uncertainty_description text,
    ablation_pit_volume_method character varying(100),
    ablation_pit_volume_software character varying(100),
    he_measurement_method character varying(100),
    parent_isotope_method character varying(100),
    surface_area_volume_equation character varying(100),
    alpha_stopping_distance_ref character varying(200),
    ft_correction_equation character varying(100),
    esr_sa_v_equation character varying(100),
    esr_ft_equation character varying(100),
    eu_equation character varying(100),
    he_age_approach character varying(100),
    corr_age_method character varying(100),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.he_whole_grain_data (
    id integer NOT NULL,
    he_datapoint_id integer NOT NULL,
    lab_no character varying(50),
    grain_identifier character varying(100),
    aliquot_type character varying(20),
    n_grains_in_aliquot integer,
    crystal_integrity character varying(20),
    grain_morphology character varying(50),
    assumed_geometry character varying(50),
    length_um numeric(10,2),
    length_um_sd numeric(10,2),
    half_width_um numeric(10,2),
    width_um_sd numeric(10,2),
    height_um numeric(10,2),
    height_um_sd numeric(10,2),
    measurement_method character varying(100),
    crystal_faces_measured character varying(200),
    he_ncc numeric(12,6),
    he_measurement_method character varying(100),
    he_extraction_temperature_c numeric(6,2),
    he_extraction_duration_min integer,
    he_extraction_method character varying(100),
    he_blank_ncc numeric(12,6),
    he_blank_error_ncc numeric(12,6),
    u_ppm numeric(10,3),
    u_ppm_error numeric(10,3),
    th_ppm numeric(10,3),
    th_ppm_error numeric(10,3),
    sm_ppm numeric(10,3),
    sm_ppm_error numeric(10,3),
    eu_ppm numeric(10,3),
    u_measurement_method character varying(100),
    u_blank_ppm numeric(10,6),
    th_blank_ppm numeric(10,6),
    sm_blank_ppm numeric(10,6),
    spike_u238_u235_ratio numeric(10,6),
    spike_th232_th229_ratio numeric(10,6),
    mass_mg numeric(10,6),
    surface_area_mm2 numeric(10,6),
    volume_mm3 numeric(10,6),
    sa_v_ratio numeric(10,6),
    rs_um numeric(10,2),
    esr_sa_v_um numeric(10,2),
    esr_ft_um numeric(10,2),
    sa_v_calc_equation character varying(100),
    ft_correction_equation character varying(100),
    alpha_stopping_distance_ref character varying(200),
    uncorr_age_ma numeric(10,2),
    uncorr_age_error_ma numeric(10,2),
    corr_age_ma numeric(10,2),
    corr_age_error_ma numeric(10,2),
    corr_age_1sigma_ma numeric(10,2),
    ft numeric(6,4),
    error_type character varying(20),
    eu_equation character varying(100),
    he_age_approach character varying(100),
    lambda_u238 character varying(30),
    lambda_th232 character varying(30),
    lambda_sm147 character varying(30),
    terminations character varying(10),
    std_run character varying(10),
    thermal_model character varying(10),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.mounts (
    id integer NOT NULL,
    mount_id character varying(50) NOT NULL,
    mount_name character varying(200),
    mount_date date,
    sample_id character varying(50),
    etchant_chemical character varying(100),
    etch_duration_seconds integer,
    etch_temperature_c numeric(5,2),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.people (
    id integer NOT NULL,
    orcid character varying(50),
    name character varying(200) NOT NULL,
    email character varying(200),
    affiliation character varying(300),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT check_orcid_or_name CHECK (((orcid IS NOT NULL) OR (name IS NOT NULL)))
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.reference_materials (
    id integer NOT NULL,
    batch_id integer NOT NULL,
    material_name character varying(100) NOT NULL,
    material_type character varying(50),
    expected_age_ma numeric(10,2),
    expected_age_error_ma numeric(10,2),
    measured_age_ma numeric(10,2),
    measured_age_error_ma numeric(10,2),
    parameter_type character varying(50),
    measured_value numeric(15,6),
    expected_value numeric(15,6),
    error numeric(15,6),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.sample_people_roles (
    id integer NOT NULL,
    sample_id character varying(50) NOT NULL,
    person_id integer NOT NULL,
    role character varying(50) NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
CREATE TABLE public.samples (
    sample_id character varying(50) NOT NULL,
    dataset_id integer DEFAULT 1,
    igsn character varying(20),
    sample_kind character varying(100),
    sample_collection_method character varying(100),
    sample_kind_additional_info text,
    latitude numeric(10,7),
    longitude numeric(10,7),
    geodetic_datum character varying(20) DEFAULT 'WGS84'::character varying,
    lat_long_precision_m integer,
    lat_long_precision_method character varying(100),
    elevation_m numeric(8,2),
    vertical_datum character varying(50) DEFAULT 'mean sea level'::character varying,
    elevation_accuracy_m numeric(8,2),
    elevation_additional_info text,
    depth_min_m numeric(10,2) DEFAULT 0,
    depth_max_m numeric(10,2) DEFAULT 0,
    depth_accuracy_m numeric(6,2),
    location_kind character varying(100),
    location_name character varying(200),
    location_description text,
    sampling_location_information text,
    lithology character varying(100),
    mineral_type character varying(50),
    stratigraphic_unit character varying(200),
    chronostratigraphic_unit_age character varying(100),
    chronostrat_age_min_ma numeric(10,2),
    chronostrat_age_max_ma numeric(10,2),
    sample_age_ma numeric(10,2),
    stratigraphic_info text,
    collection_date_min date,
    collection_date_max date,
    collection_date_exact date,
    last_known_sample_archive character varying(200),
    archive_additional_info text,
    funding_grant_id character varying(100),
    associated_references text,
    keywords text,
    n_aft_grains integer,
    n_ahe_grains integer,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
    s.sampling_location_information,
    s.latitude,
    s.longitude,
    s.elevation_m,
    ftd.central_age_ma,
    ftd.central_age_error_ma,
    ftd.pooled_age_ma,
    ftd.pooled_age_error_ma,
    ftd.dispersion_pct,
    ftd.p_chi2_pct,
    ftd.n_grains,
    ftd.mean_track_length_um,
    ftd.sd_track_length_um,
    ftd.n_track_measurements,
    ftd.mean_rho_s,
    ftd.total_ns,
    ftd.mean_u_ppm,
    ftd.mean_dpar_um
     LEFT JOIN LATERAL ( SELECT ft_datapoints.id,
            ft_datapoints.sample_id,
            ft_datapoints.datapoint_key,
            ft_datapoints.batch_id,
            ft_datapoints.laboratory,
            ft_datapoints.analyst_orcid,
            ft_datapoints.analysis_date,
            ft_datapoints.publication_doi,
            ft_datapoints.mineral_type,
            ft_datapoints.ft_method,
            ft_datapoints.ft_software,
            ft_datapoints.ft_algorithm,
            ft_datapoints.u_determination_method,
            ft_datapoints.n_grains,
            ft_datapoints.total_area_cm2,
            ft_datapoints.mean_rho_s,
            ft_datapoints.total_ns,
            ft_datapoints.mean_rho_i,
            ft_datapoints.total_ni,
            ft_datapoints.mean_rho_d,
            ft_datapoints.total_nd,
            ft_datapoints.dosimeter,
            ft_datapoints.mean_u_ppm,
            ft_datapoints.sd_u_ppm,
            ft_datapoints.mean_dpar_um,
            ft_datapoints.se_dpar_um,
            ft_datapoints.n_dpar_measurements,
            ft_datapoints.mean_dper_um,
            ft_datapoints.se_dper_um,
            ft_datapoints.n_dper_measurements,
            ft_datapoints.mean_rmr0,
            ft_datapoints.sd_rmr0,
            ft_datapoints.mean_kappa,
            ft_datapoints.sd_kappa,
            ft_datapoints.rmr0_equation,
            ft_datapoints.chi_square,
            ft_datapoints.p_chi2_pct,
            ft_datapoints.dispersion_pct,
            ft_datapoints.age_equation,
            ft_datapoints.mean_age_ma,
            ft_datapoints.mean_age_error_ma,
            ft_datapoints.central_age_ma,
            ft_datapoints.central_age_error_ma,
            ft_datapoints.pooled_age_ma,
            ft_datapoints.pooled_age_error_ma,
            ft_datapoints.population_age_ma,
            ft_datapoints.population_age_error_ma,
            ft_datapoints.age_error_type,
            ft_datapoints.age_comment,
            ft_datapoints.mean_track_length_um,
            ft_datapoints.se_mean_track_length_um,
            ft_datapoints.n_track_measurements,
            ft_datapoints.sd_track_length_um,
            ft_datapoints.cf252_irradiation,
            ft_datapoints.etchant_chemical,
            ft_datapoints.etch_duration_seconds,
            ft_datapoints.etch_temperature_c,
            ft_datapoints.zeta_yr_cm2,
            ft_datapoints.zeta_error_yr_cm2,
            ft_datapoints.zeta_error_type,
            ft_datapoints.r_um,
            ft_datapoints.lambda_d,
            ft_datapoints.lambda_f,
            ft_datapoints.q_factor,
            ft_datapoints.irradiation_reactor,
            ft_datapoints.thermal_neutron_dose,
            ft_datapoints.irradiation_batch_id,
            ft_datapoints.created_at
           FROM public.ft_datapoints
          WHERE ((ft_datapoints.sample_id)::text = (s.sample_id)::text)
          ORDER BY ft_datapoints.analysis_date DESC
         LIMIT 1) ftd ON (true));
    s.igsn,
    s.latitude,
    s.longitude,
    s.elevation_m,
    s.lithology,
    s.mineral_type,
    s.sampling_location_information,
    s.n_aft_grains,
    s.n_ahe_grains,
    ( SELECT ft_datapoints.central_age_ma
           FROM public.ft_datapoints
          WHERE ((ft_datapoints.sample_id)::text = (s.sample_id)::text)
          ORDER BY ft_datapoints.analysis_date DESC
         LIMIT 1) AS aft_central_age_ma,
    ( SELECT ft_datapoints.central_age_error_ma
           FROM public.ft_datapoints
          WHERE ((ft_datapoints.sample_id)::text = (s.sample_id)::text)
          ORDER BY ft_datapoints.analysis_date DESC
         LIMIT 1) AS aft_age_error_ma,
    ( SELECT ft_datapoints.dispersion_pct
           FROM public.ft_datapoints
          WHERE ((ft_datapoints.sample_id)::text = (s.sample_id)::text)
          ORDER BY ft_datapoints.analysis_date DESC
         LIMIT 1) AS aft_dispersion_pct,
    ( SELECT ft_datapoints.p_chi2_pct
           FROM public.ft_datapoints
          WHERE ((ft_datapoints.sample_id)::text = (s.sample_id)::text)
          ORDER BY ft_datapoints.analysis_date DESC
         LIMIT 1) AS aft_p_chi2,
    ( SELECT ft_datapoints.mean_track_length_um
           FROM public.ft_datapoints
          WHERE ((ft_datapoints.sample_id)::text = (s.sample_id)::text)
          ORDER BY ft_datapoints.analysis_date DESC
         LIMIT 1) AS aft_mtl_um,
    ( SELECT avg(hg.corr_age_ma) AS avg
           FROM (public.he_whole_grain_data hg
             JOIN public.he_datapoints hd ON ((hg.he_datapoint_id = hd.id)))
          WHERE ((hd.sample_id)::text = (s.sample_id)::text)) AS ahe_mean_age_ma,
    ( SELECT stddev(hg.corr_age_ma) AS stddev
           FROM (public.he_whole_grain_data hg
             JOIN public.he_datapoints hd ON ((hg.he_datapoint_id = hd.id)))
          WHERE ((hd.sample_id)::text = (s.sample_id)::text)) AS ahe_age_sd_ma,
    d.dataset_name,
    d.study_area
     LEFT JOIN public.datasets d ON ((s.dataset_id = d.id)));
    ADD CONSTRAINT batches_batch_name_key UNIQUE (batch_name);
    ADD CONSTRAINT batches_pkey PRIMARY KEY (id);
    ADD CONSTRAINT data_files_pkey PRIMARY KEY (id);
    ADD CONSTRAINT datapoint_people_roles_pkey PRIMARY KEY (id);
    ADD CONSTRAINT dataset_people_roles_dataset_id_person_id_role_key UNIQUE (dataset_id, person_id, role);
    ADD CONSTRAINT dataset_people_roles_pkey PRIMARY KEY (id);
    ADD CONSTRAINT datasets_pkey PRIMARY KEY (id);
    ADD CONSTRAINT "earthbank_ftDatapoints_datapointName_key" UNIQUE ("datapointName");
    ADD CONSTRAINT "earthbank_ftDatapoints_pkey" PRIMARY KEY (id);
    ADD CONSTRAINT "earthbank_ftTrackLengthData_pkey" PRIMARY KEY (id);
    ADD CONSTRAINT "earthbank_heDatapoints_datapointName_key" UNIQUE ("datapointName");
    ADD CONSTRAINT "earthbank_heDatapoints_pkey" PRIMARY KEY (id);
    ADD CONSTRAINT "earthbank_heWholeGrainData_datapointName_grainName_key" UNIQUE ("datapointName", "grainName");
    ADD CONSTRAINT "earthbank_heWholeGrainData_pkey" PRIMARY KEY (id);
    ADD CONSTRAINT "earthbank_samples_IGSN_key" UNIQUE ("IGSN");
    ADD CONSTRAINT earthbank_samples_pkey PRIMARY KEY (id);
    ADD CONSTRAINT "earthbank_samples_sampleID_key" UNIQUE ("sampleID");
    ADD CONSTRAINT extraction_sessions_pkey PRIMARY KEY (id);
    ADD CONSTRAINT extraction_sessions_session_id_key UNIQUE (session_id);
    ADD CONSTRAINT fair_score_breakdown_dataset_id_key UNIQUE (dataset_id);
    ADD CONSTRAINT fair_score_breakdown_pkey PRIMARY KEY (id);
    ADD CONSTRAINT ft_binned_length_data_pkey PRIMARY KEY (id);
    ADD CONSTRAINT ft_count_data_ft_datapoint_id_grain_id_key UNIQUE (ft_datapoint_id, grain_id);
    ADD CONSTRAINT ft_count_data_pkey PRIMARY KEY (id);
    ADD CONSTRAINT ft_datapoints_datapoint_key_key UNIQUE (datapoint_key);
    ADD CONSTRAINT ft_datapoints_pkey PRIMARY KEY (id);
    ADD CONSTRAINT ft_single_grain_ages_ft_datapoint_id_grain_id_key UNIQUE (ft_datapoint_id, grain_id);
    ADD CONSTRAINT ft_single_grain_ages_pkey PRIMARY KEY (id);
    ADD CONSTRAINT ft_track_length_data_ft_datapoint_id_grain_id_track_id_key UNIQUE (ft_datapoint_id, grain_id, track_id);
    ADD CONSTRAINT ft_track_length_data_pkey PRIMARY KEY (id);
    ADD CONSTRAINT grains_grain_id_key UNIQUE (grain_id);
    ADD CONSTRAINT grains_pkey PRIMARY KEY (id);
    ADD CONSTRAINT he_datapoints_datapoint_key_key UNIQUE (datapoint_key);
    ADD CONSTRAINT he_datapoints_pkey PRIMARY KEY (id);
    ADD CONSTRAINT he_whole_grain_data_lab_no_key UNIQUE (lab_no);
    ADD CONSTRAINT he_whole_grain_data_pkey PRIMARY KEY (id);
    ADD CONSTRAINT mounts_mount_id_key UNIQUE (mount_id);
    ADD CONSTRAINT mounts_pkey PRIMARY KEY (id);
    ADD CONSTRAINT people_orcid_key UNIQUE (orcid);
    ADD CONSTRAINT people_pkey PRIMARY KEY (id);
    ADD CONSTRAINT reference_materials_pkey PRIMARY KEY (id);
    ADD CONSTRAINT sample_people_roles_pkey PRIMARY KEY (id);
    ADD CONSTRAINT sample_people_roles_sample_id_person_id_role_key UNIQUE (sample_id, person_id, role);
    ADD CONSTRAINT samples_igsn_key UNIQUE (igsn);
    ADD CONSTRAINT samples_pkey PRIMARY KEY (sample_id);
    ADD CONSTRAINT data_files_dataset_id_fkey FOREIGN KEY (dataset_id) REFERENCES public.datasets(id) ON DELETE CASCADE;
    ADD CONSTRAINT datapoint_people_roles_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.people(id) ON DELETE CASCADE;
    ADD CONSTRAINT dataset_people_roles_dataset_id_fkey FOREIGN KEY (dataset_id) REFERENCES public.datasets(id) ON DELETE CASCADE;
    ADD CONSTRAINT dataset_people_roles_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.people(id) ON DELETE CASCADE;
    ADD CONSTRAINT "earthbank_ftDatapoints_sampleID_fkey" FOREIGN KEY ("sampleID") REFERENCES public.earthbank_samples("sampleID") ON DELETE CASCADE;
    ADD CONSTRAINT "earthbank_ftTrackLengthData_datapointName_fkey" FOREIGN KEY ("datapointName") REFERENCES public."earthbank_ftDatapoints"("datapointName") ON DELETE CASCADE;
    ADD CONSTRAINT "earthbank_heDatapoints_sampleID_fkey" FOREIGN KEY ("sampleID") REFERENCES public.earthbank_samples("sampleID") ON DELETE CASCADE;
    ADD CONSTRAINT "earthbank_heWholeGrainData_datapointName_fkey" FOREIGN KEY ("datapointName") REFERENCES public."earthbank_heDatapoints"("datapointName") ON DELETE CASCADE;
    ADD CONSTRAINT extraction_sessions_dataset_id_fkey FOREIGN KEY (dataset_id) REFERENCES public.datasets(id);
    ADD CONSTRAINT fair_score_breakdown_dataset_id_fkey FOREIGN KEY (dataset_id) REFERENCES public.datasets(id) ON DELETE CASCADE;
    ADD CONSTRAINT ft_binned_length_data_ft_datapoint_id_fkey FOREIGN KEY (ft_datapoint_id) REFERENCES public.ft_datapoints(id) ON DELETE CASCADE;
    ADD CONSTRAINT ft_count_data_ft_datapoint_id_fkey FOREIGN KEY (ft_datapoint_id) REFERENCES public.ft_datapoints(id) ON DELETE CASCADE;
    ADD CONSTRAINT ft_datapoints_batch_id_fkey FOREIGN KEY (batch_id) REFERENCES public.batches(id);
    ADD CONSTRAINT ft_datapoints_sample_id_fkey FOREIGN KEY (sample_id) REFERENCES public.samples(sample_id) ON DELETE CASCADE;
    ADD CONSTRAINT ft_single_grain_ages_ft_datapoint_id_fkey FOREIGN KEY (ft_datapoint_id) REFERENCES public.ft_datapoints(id) ON DELETE CASCADE;
    ADD CONSTRAINT ft_track_length_data_ft_datapoint_id_fkey FOREIGN KEY (ft_datapoint_id) REFERENCES public.ft_datapoints(id) ON DELETE CASCADE;
    ADD CONSTRAINT grains_mount_id_fkey FOREIGN KEY (mount_id) REFERENCES public.mounts(mount_id) ON DELETE SET NULL;
    ADD CONSTRAINT he_datapoints_batch_id_fkey FOREIGN KEY (batch_id) REFERENCES public.batches(id);
    ADD CONSTRAINT he_datapoints_sample_id_fkey FOREIGN KEY (sample_id) REFERENCES public.samples(sample_id) ON DELETE CASCADE;
    ADD CONSTRAINT he_whole_grain_data_he_datapoint_id_fkey FOREIGN KEY (he_datapoint_id) REFERENCES public.he_datapoints(id) ON DELETE CASCADE;
    ADD CONSTRAINT mounts_sample_id_fkey FOREIGN KEY (sample_id) REFERENCES public.samples(sample_id) ON DELETE SET NULL;
    ADD CONSTRAINT reference_materials_batch_id_fkey FOREIGN KEY (batch_id) REFERENCES public.batches(id) ON DELETE CASCADE;
    ADD CONSTRAINT sample_people_roles_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.people(id) ON DELETE CASCADE;
    ADD CONSTRAINT sample_people_roles_sample_id_fkey FOREIGN KEY (sample_id) REFERENCES public.samples(sample_id) ON DELETE CASCADE;
    ADD CONSTRAINT samples_dataset_id_fkey FOREIGN KEY (dataset_id) REFERENCES public.datasets(id);
